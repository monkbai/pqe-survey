\usepackage{listings}
\usepackage{xcolor}

\newcommand{\F}{Fig.}
\newcommand{\E}{Eq.}
%\renewcommand{\F}{Figure}
\newcommand{\T}{Table}
%\renewcommand{\S}{Section}
\renewcommand{\S}{Sec.}
\newcommand{\A}{Alg.}

\newcommand{\fixme}[1]{{\color{blue}\textbf{#1}}}

\lstdefinestyle{base}{
  moredelim=**[is][\color{red}]{@}{@},
  escapeinside={<@}{@>}
}

\lstdefinelanguage
   [x64]{Assembler}     % add a "x64" dialect of Assembler
   [x86masm]{Assembler} % based on the "x86masm" dialect
   % with these extra keywords:
   {morekeywords={CDQE,CQO,CMPSQ,CMPXCHG16B,JRCXZ,LODSQ,MOVSXD, %
                  POPFQ,PUSHFQ,SCASQ,STOSQ,IRETQ,RDTSCP,SWAPGS, %
                  rax,rdx,rcx,rbx,rsi,rdi,rsp,rbp, %
                  r8,r8d,r8w,r8b,r9,r9d,r9w,r9b},
    deletekeywords={code}} % etc.


\lstdefinestyle{customasm}{
  belowcaptionskip=1\baselineskip,
  frame=single,
  xleftmargin=\parindent,
  language=[x86masm]Assembler,
  basicstyle=\footnotesize\ttfamily,
  deletekeywords={code},
  commentstyle=\itshape\color{gray},
}

\lstset{escapechar=@,style=customasm,language=[x64]Assembler}
